(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{mO3v:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return l})),a.d(t,"default",(function(){return s}));a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("91GP"),a("q1tI");var n=a("7ljp"),i=a("L6Je");var l={},c={_frontmatter:l},r=i.a;function s(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,["components"]);return Object(n.b)(r,Object.assign({},c,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)("h1",{id:"scripts",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h1"},{href:"#scripts","aria-label":"scripts permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Scripts"),Object(n.b)("p",null,"Scripts in Vibranium allow you to execute JavaScript snippets in the life cycle phases of execution. There are two levels of scripts available, at scenarios and at endpoint level. "),Object(n.b)("p",null,"All the scripts are executed inside and ",Object(n.b)("inlineCode",{parentName:"p"},"async")," function, so you can use await and other es6 snippets here."),Object(n.b)("p",null,"The life cyle events are slightly different at both levels and the flow can be summarized as:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"before-scenario")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-globals")),Object(n.b)("li",{parentName:"ul"}),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"before-each"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"before-endpoint")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-dependencies")),Object(n.b)("li",{parentName:"ul"},"... (endpoint1 execution)"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-endpoint")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-each")),Object(n.b)("li",{parentName:"ul"}),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"before-each"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"before-endpoint")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-dependencies")),Object(n.b)("li",{parentName:"ul"},"... (endpoint1 execution)"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-endpoint")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-each")),Object(n.b)("li",{parentName:"ul"}),Object(n.b)("li",{parentName:"ul"},"... (other endpoints)"),Object(n.b)("li",{parentName:"ul"}),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"after-scenario"))),Object(n.b)("p",null,"The JS snippets that you can use has a limitation on the available variables and functions. For example, you will not be able to access the ",Object(n.b)("inlineCode",{parentName:"p"},"console")," object in these scripts, instead you'll have to use the ",Object(n.b)("inlineCode",{parentName:"p"},"logger")," object."),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"If you need to run a script from a file, place the file inside the scripts directory and call the ",Object(n.b)("inlineCode",{parentName:"p"},"scriptFile")," function with the script fileName. ")),Object(n.b)("h2",{id:"scenario-level",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h2"},{href:"#scenario-level","aria-label":"scenario level permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Scenario level"),Object(n.b)("h3",{id:"variables-and-functions-available",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#variables-and-functions-available","aria-label":"variables and functions available permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Variables and functions available"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"logger")," to print the logs"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"setTimeout")," for delayed execution"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"setInterval")," for repeated execution"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"fetch")," for making network calls using the ",Object(n.b)("a",Object.assign({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"}),"fetch api")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"exec")," for executing shell commands. Uses the promisified version of ",Object(n.b)("a",Object.assign({parentName:"li"},{href:"https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback"}),"Node exec"),". Example:",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"const { stdout, stderr } = await exec('ls');\nconsole.log('stdout:', stdout);\nconsole.error('stderr:', stderr);\n"))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"variables")," is an object containing the scenario variables"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"getApiResponse")," is a function with which you can execute other endpoint tests and return the response. Example: ",Object(n.b)("inlineCode",{parentName:"li"},"let response = await getApiResponse(collectionName, scenarioName, endpointName)")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"scriptFile")," a function that can be called to load script from a file. The file should be placed inside ",Object(n.b)("strong",{parentName:"li"},"scripts")," directory inside your tests directory (along with scenarios, payloads, schemas etc). Note: the file extension should be specified, and the file path should be relative path inside the scripts directory. Usage: ",Object(n.b)("inlineCode",{parentName:"li"},"scriptFile('scriptFileToExecute.js')"))),Object(n.b)("h3",{id:"return-structure",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#return-structure","aria-label":"return structure permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Return structure"),Object(n.b)("p",null,"If you want the data in the script to be used in your endpoint test, you have to expose it as variables. In order to do this, just add a new key to the ",Object(n.b)("inlineCode",{parentName:"p"},"variables")," object that you have access to in the script, with the key as the variable name and the value as the variable value, and the in the end of your script, return the variables object."),Object(n.b)("p",null,"Example: ",Object(n.b)("inlineCode",{parentName:"p"},'"before-scenario": "variables.hello=\'world\'; return variables"')),Object(n.b)("p",null,"And then in url/payload, you can use the variable"),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-json"}),'{\n    "payload": {\n        "key": "{hello}"\n    }\n}\n')),Object(n.b)("h3",{id:"executing-shell-scripts",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#executing-shell-scripts","aria-label":"executing shell scripts permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Executing shell scripts"),Object(n.b)("p",null,"You can execute shell scripts and get the response from them using the ",Object(n.b)("inlineCode",{parentName:"p"},"exec")," function available in the scripts. Uses the promisified version of ",Object(n.b)("a",Object.assign({parentName:"p"},{href:"https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback"}),"Node exec"),". Example:"),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"const { stdout, stderr } = await exec('npm start');\nconsole.log('stdout:', stdout);\nconsole.error('stderr:', stderr);\n")),Object(n.b)("h3",{id:"example",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#example","aria-label":"example permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Example"),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-json"}),'{\n    "before-scenario": "logger.log(\'Life cycle Hook: before-scenario\')",\n    "after-scenario": "logger.log(\'Life cycle Hook: after-scenario\')",\n    "before-each": "logger.log(\'Life cycle Hook: before-each\')",\n    "after-each": "logger.log(\'Life cycle Hook: after-each\')",\n    "after-globals": "logger.log(\'Life cycle Hook: after-globals\')"\n}\n')),Object(n.b)("h2",{id:"endpoint-level",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h2"},{href:"#endpoint-level","aria-label":"endpoint level permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Endpoint level"),Object(n.b)("h3",{id:"variables-and-functions-available-1",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#variables-and-functions-available-1","aria-label":"variables and functions available 1 permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Variables and functions available"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"logger")," to print the logs"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"setTimeout")," for delayed execution"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"setInterval")," for repeated execution"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"fetch")," for making network calls using the ",Object(n.b)("a",Object.assign({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"}),"fetch api")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"variables")," is an object containing the scenario variables"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"exec")," for executing shell commands. Uses the promisified version of ",Object(n.b)("a",Object.assign({parentName:"li"},{href:"https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback"}),"Node exec"),". Example:",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"const { stdout, stderr } = await exec('ls');\nconsole.log('stdout:', stdout);\nconsole.error('stderr:', stderr);\n"))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"getApiResponse")," is a function with which you can execute other endpoint tests and return the response. Example: ",Object(n.b)("inlineCode",{parentName:"li"},"let response = await getApiResponse(collectionName, scenarioName, endpointName)")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"api")," the endpoint test object, if you need to modify the payload."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"scriptFile")," a function that can be called to load script from a file. The file should be placed inside ",Object(n.b)("strong",{parentName:"li"},"scripts")," directory inside your tests directory (along with scenarios, payloads, schemas etc). Note: the file extension should be specified, and the file path should be relative path inside the scripts directory. Usage: ",Object(n.b)("inlineCode",{parentName:"li"},"scriptFile('scriptFileToExecute.js')"))),Object(n.b)("h3",{id:"return-structure-1",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#return-structure-1","aria-label":"return structure 1 permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Return structure"),Object(n.b)("p",null,"The return structure for endpoint scripts is slightly different from that of scenario. The response for endpoint scripts contains both the api and the variables. Incase you don't update any of them, you can omit them in the return response."),Object(n.b)("p",null,"Response: ",Object(n.b)("inlineCode",{parentName:"p"},"{ api, variables }")),Object(n.b)("p",null,"Example: ",Object(n.b)("inlineCode",{parentName:"p"},'"before-scenario": "variables.hello=\'world\'; return { variables }"')),Object(n.b)("p",null,"And then in url/payload, you can use the variable"),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-json"}),'{\n    "payload": {\n        "key": "{hello}"\n    }\n}\n')),Object(n.b)("h3",{id:"example-1",style:{position:"relative"}},Object(n.b)("a",Object.assign({parentName:"h3"},{href:"#example-1","aria-label":"example 1 permalink",className:"anchor before"}),Object(n.b)("svg",Object.assign({parentName:"a"},{"aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"}),Object(n.b)("path",Object.assign({parentName:"svg"},{fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"})))),"Example"),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-json"}),'{\n    "before-endpoint": "logger.log(\'Lifecycle Hook: before-endpoint\')",\n    "after-endpoint": "logger.log(\'Lifecycle Hook: after-endpoint\')",\n    "after-dependencies": "logger.log(\'Lifecycle Hook: after-dependencies\')"\n}\n')),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"[IMPORTANT]"," please note that the return object structure is different for scenario scripts and for endpoint scripts. In scenario, it is just the variables object and in endpoint, it is both variables and api. If you skip returning values, the changes you make inside the script will be ignored, ")))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-docs-3-5-scripts-mdx-6c19ea759fd57e952146.js.map